<h3 mat-dialog-title>Tomar asistencia del día:</h3>
<div *ngIf="deshabilitadoTemporalmente" class="message-box info">
  No podrá tomar asistencia hasta el día que inicia la planilla ({{ planillaTaller.fechaInicio | date: 'dd/MM/yyyy':'GMT' }})
</div>
<form [formGroup]="form" fxLayout="row" fxLayoutAlign="center start">
  <mat-form-field appearance="outline" fxFlex="100">
    <mat-label>Fecha</mat-label>
    <input [max]="maximo" [min]="minimo" autocomplete="off" matInput [matDatepicker]="picker" formControlName="fecha" />
    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
    <mat-datepicker #picker></mat-datepicker>
    <mat-error *ngIf="form.controls.fecha.hasError('required')"> Este campo es requerido. </mat-error>
  </mat-form-field>
</form>
<div mat-dialog-content>
  <table
    mat-table
    matSort
    #sort="matSort"
    [dataSource]="dataSource"
    [class.mat-elevation-z4]="!isMobile"
    class="border w-100-p"
    [class.mt-20]="!alumnos || alumnos.length < 1"
  >
    <!-- 'nombreCompleto', 'seguimientoEtap' -->
    <ng-container matColumnDef="nombreCompleto">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Nombre</th>
      <td mat-cell *matCellDef="let row">
        <span
          [ngClass]="{
            row_seleccionada: row.selected
          }"
        >
          {{ row.nombreCompleto }}
        </span>
      </td>
    </ng-container>

    <ng-container matColumnDef="ausente">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Presente</th>
      <td mat-cell *matCellDef="let row">
        <div>
          <mat-checkbox
            class="checkbox_invisible"
            [(ngModel)]="row.presente"
            [color]="row.presente != false && row.presente != true ? 'warn' : 'accent'"
            [indeterminate]="row.presente != false && row.presente != true"
          >
            <div (click)="toggleAsistencia(row)">
              <!-- 0. Sin tomar asistencia -->
              <div *ngIf="!row.tomarAsistencia || row.tomarAsistencia == 0" matTooltip="Presione para tomar asistencia">
                <span class="iconify" data-icon="fluent:person-question-mark-20-filled" data-inline="false" style="font-size: 28px"></span>
              </div>
              <!-- 1. Presente -->
              <div *ngIf="row.tomarAsistencia == 1" matTooltip="Está Presente">
                <span
                  *ngIf="row.sexo == 'MASCULINO'"
                  class="iconify"
                  data-icon="noto:person-raising-hand-light-skin-tone"
                  data-inline="false"
                  style="font-size: 32px"
                ></span>
                <span
                  *ngIf="row.sexo == 'FEMENINO'"
                  class="iconify"
                  data-icon="noto:woman-raising-hand-light-skin-tone"
                  data-inline="false"
                  style="font-size: 32px"
                ></span>

                <span
                  *ngIf="row.sexo != 'FEMENINO' && row.sexo != 'MASCULINO'"
                  class="iconify"
                  data-icon="noto:hand-with-fingers-splayed-light-skin-tone"
                  data-inline="false"
                  style="font-size: 32px"
                ></span>
              </div>
              <!-- 2. Ausente -->
              <div *ngIf="row.tomarAsistencia == 2" matTooltip="Está Ausente">
                <span
                  class="iconify"
                  data-icon="ic:twotone-no-accounts"
                  data-inline="false"
                  style="font-size: 28px; color: rgb(201, 6, 6)"
                ></span>
              </div>
              <!-- 3. Ausente Permitido -->
              <div *ngIf="row.tomarAsistencia == 3" matTooltip="No debe venir">
                <span
                  class="iconify"
                  data-icon="ic:twotone-no-accounts"
                  data-inline="false"
                  style="font-size: 28px; color: rgb(46, 161, 0)"
                ></span>
              </div>
            </div>
          </mat-checkbox>
        </div>
      </td>
    </ng-container>
    <ng-container matColumnDef="tarde">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>En Horario</th>
      <td mat-cell *matCellDef="let row">
        <div>
          <mat-checkbox class="checkbox_invisible" [(ngModel)]="row.tarde">
            <div *ngIf="!row.tarde" [matTooltip]="row.tarde ? 'Llegada tarde' : 'LLegó a horario'">
              <span class="iconify" data-icon="emojione:ballot-box-with-check" data-inline="false" style="font-size: 24px"></span>
            </div>
            <div *ngIf="row.tarde" [matTooltip]="row.tarde ? 'Llegada tarde' : 'LLegó a horario'">
              <span
                class="iconify"
                data-icon="ic:twotone-watch-later"
                data-inline="false"
                style="font-size: 28px; color: rgb(255, 94, 0)"
              ></span>
            </div>
          </mat-checkbox>
        </div>
      </td>
    </ng-container>
    <tr mat-header-row *matHeaderRowDef="columnas"></tr>
    <tr
      mat-row
      *matRowDef="let row; columns: columnas"
      [class.selected]="row.selected"
      [ngClass]="{
        hovered: row.hovered,
        highlighted: row.highlighted
      }"
    ></tr>
  </table>
  <app-empty-data *ngIf="!alumnos || alumnos.length < 1"></app-empty-data>
  <!-- Paginado -------------------------------------------------- -->
  <mat-paginator class="border-paginador paginator mat-elevation-z2" #paginator [pageSize]="20" [pageSizeOptions]="[5, 10, 25, 100]">
  </mat-paginator>
</div>
<div mat-dialog-actions class="w-100-p" fxLayout="row" fxLayoutAlign="center start">
  <!--   -->
  <button
    [disabled]="deshabilitadoTemporalmente || controlAsistencias()"
    mat-raised-button
    fxFlex="100"
    color="accent"
    (click)="tomarAsistenciaMasivo()"
  >
    GUARDAR ASISTENCIAS
  </button>
</div>
